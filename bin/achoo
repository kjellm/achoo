#!/usr/bin/env ruby

require 'achoo'
require 'achoo/rc_loader'
require 'optparse'

include Achoo::RCLoader

def main
  trap("INT") {puts; exit} # Print a newline in case we are prompting
  load_rc
  options = parse_args
  achoo = Achoo.new(options[:log])
  achoo.start
end

def parse_args
  options = {}

  optparse = OptionParser.new do|opts|
    opts.banner = "Usage: $0 [options]"

    options[:log] = false
    opts.on( '-l', '--log', 'Write http communication to achoo_http.log' ) do
      options[:log] = true
    end
  end

  optparse.parse!
  options
end

main
